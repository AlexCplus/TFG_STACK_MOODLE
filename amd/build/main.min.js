define(["jquery","jqueryui","block_stack/main"],function(){return{init:function(){window.console.log("teacher");var e=document.querySelectorAll("#menu-courses");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.target.id.split("-");require(["core/ajax","core/notification"],function(e,l){window.console.log(e);var n={methodname:"block_stack_get_chart_db",args:{id_course:t[1]}};e.call([n])[0].done(function(e){require(["core/chartjs"],function(){let t=document.createElement("canvas");t.setAttribute("id","myChart"),document.querySelector("#render-chart").appendChild(t);let l=t.getContext("2d");new Chart(l,{type:"doughnut",data:{labels:["Superados","No Superados",],datasets:[{label:"% de estudiantes",title:"Total de cuestionarios con m\xe1s de un intento",data:[e.passed,e.not_passed],backgroundColor:["rgb(119, 221, 119)","rgb(255, 0, 0)"],hoverOffset:4}]}})}),document.getElementById("course_not_selected").hidden=!0,window.console.log(e)}).fail(function(e){window.console.log(e)})})})},init_student:function(){window.console.log("student");var e=document.querySelectorAll("#menu-courses");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.target.id.split("-");require(["core/ajax","core/notification"],function(e,l){window.console.log(e);var n={methodname:"block_stack_get_chart_db_student",args:{id_course:t[1]}};e.call([n])[0].done(function(e){require(["core/chartjs"],function(){let t=document.createElement("canvas");t.setAttribute("id","myChart"),document.querySelector("#render-chart").appendChild(t);let l=t.getContext("2d");new Chart(l,{type:"doughnut",data:{labels:["Superados","No Superados",],datasets:[{label:"% de estudiantes",title:"Total de cuestionarios con m\xe1s de un intento",data:[e.passed,e.not_passed],backgroundColor:["rgb(119, 221, 119)","rgb(255, 0, 0)"],hoverOffset:4}]}})}),document.getElementById("course_not_selected").hidden=!0,window.console.log(e)}).fail(function(e){window.console.log(e)})})})},search:function(){document.querySelector("input").addEventListener("input",function(e){window.console.log(e.target.value),require(["core/ajax","core/notification"],function(t,l){window.console.log(l);var n={methodname:"block_stack_get_table_students",args:{input_value:e.target.value}};t.call([n])[0].done(function(e){window.console.log(e),null!=document.querySelector("#students-list")&&$("#students-list").remove();let t=document.createElement("ul");t.setAttribute("id","students-list"),t.setAttribute("class","list-group"),e.forEach(e=>{let l=document.createElement("li");l.setAttribute("class","list-group-item"),t.appendChild(l),l.innerHTML=l.innerHTML+e.name}),document.querySelector('[role="main"]').appendChild(t);var l=document.querySelectorAll("#students-list li");for(let n=0;n<l.length;n++)l[n].addEventListener("click",function(e){$("#search-student").val(l[n].innerText),window.console.log(l[n]),l[n].removeAttribute("class"),l[n].setAttribute("class","list-group-item active")})}).fail(function(e){window.console.log(e)})})})},graph:function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.id="MathJax-script",e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}};let t=document.querySelector(".custom-select");t.addEventListener("change",function(e){require(["core/ajax","core/notification"],function(e,l){window.console.log("Entrada"+t.selectedOptions[0].value);var n={methodname:"block_stack_get_questions_shown",args:{selected_item:t.selectedOptions[0].value}};e.call([n])[0].done(function(e){document.querySelector("#container-questions .row")&&document.querySelector("#container-questions .row").remove(),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),window.console.log(e),document.querySelectorAll(".custom-select")[1]&&document.querySelectorAll(".custom-select")[1].remove(),document.querySelector(".user")&&document.querySelector(".user").remove();let t=document.createElement("div"),l=document.createElement("select");l.setAttribute("class","custom-select"),l.style.marginTop="40px";let n=document.createElement("option");n.value="-1",n.text="-Selecciona un intento",n.selected,l.appendChild(n),document.querySelector("#container-questions").appendChild(t),document.querySelector("#container-questions").appendChild(l);for(var o=0;o<e.length;o++){let a=!1;for(var r=0;r<document.getElementsByTagName("select")[1].childElementCount;r++)document.getElementsByTagName("select")[1].children[r].value==e[o].attempt&&(a=!0);if(!a){let s=document.createElement("option");s.value=e[o].attempt,s.text="Intento: "+e[o].attempt,l.appendChild(s)}}t.setAttribute("class","user"),t.style.backgroundColor="hwb(180deg 94% 2%)",t.style.margin="inherit",t.style.height="300px";let c=document.createElement("canvas");t.appendChild(c);for(var i=[],u=[],o=0;o<e.length;o++)i[o]="Intento "+e[o].attempt,u[o]=e[o].mark;require(["core/chartjs"],function(){let e=document.getElementsByTagName("canvas")[0].getContext("2d");new Chart(e,{type:"line",data:{labels:i,datasets:[{label:"Evoluci\xf3n de las calificaciones atendiendo a los intentos",data:u,fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}})});let d=document.createElement("div");d.setAttribute("class","row"),d.style.backgroundColor="beige",d.style.margin="inherit",document.querySelectorAll(".custom-select")[1].addEventListener("change",function(t){document.querySelector("#container-questions .row")&&(document.querySelector("#container-questions .row").innerHTML=""),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),e.forEach(e=>{let t=document.querySelectorAll(".custom-select")[1].selectedIndex;if(e.attempt==t){let l=document.createElement("div");l.setAttribute("class","col-lg-4 col-md-6 col-sm-6"),d.appendChild(l);let n=document.createElement("div");n.setAttribute("class","category mb-30"),l.appendChild(n),n.style.paddingTop="50px",n.style.paddingBottom="50px";let o=document.createElement("div");o.setAttribute("class","question"),o.setAttribute("id",e.id),o.style.height="200px",o.style.border="1px solid transparent",o.style.padding="30px 19px 25px 19px",o.style.borderRadius="5px",o.style.boxShadow="rgba(0, 0, 0, 0.35) 0px 5px 15px",o.style.cursor="pointer",o.style.overflow="auto",n.appendChild(o);let a=document.createElement("span");a.setAttribute("class","colors1 mb-4"),a.style.fontWeight="700",o.appendChild(a),a.innerHTML=e.name;let r=document.createElement("span");r.setAttribute("class","colors1 mb-4"),o.appendChild(r),r.innerHTML="<br> Puntuaci\xf3n: "+e.mark+"/"+e.maxgrade;let s=document.createElement("h3");s.innerHTML="Preguntas",s.style.paddingTop="15px",s.style.paddingLeft="1px",s.style.position="absolute",d.appendChild(s)}}),document.querySelector("#container-questions").appendChild(d),window.console.log(d),document.querySelectorAll(".question").forEach(function(t){t.onmouseover=function(){t.style.borderColor="#0d6efd"},t.onmouseout=function(){t.style.borderColor="transparent"},t.addEventListener("click",function(){document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),e.forEach(function(e){if(e.id==t.id){window.console.log(e),window.console.log(t);let l=document.createElement("div");l.setAttribute("class","svg-graph"),l.style.backgroundColor="bisque",l.style.marginTop="50px",l.style.display="grid";let n=JSON.parse(e.graph);window.console.log(n),Array.isArray(n)?n.forEach(function(e){window.console.log(e);let t=document.createElement("div");t.innerHTML+=e,l.appendChild(t)}):l.appendChild(n),document.querySelector("#container-questions").appendChild(l);let o=document.querySelectorAll(".stack_abstract_graph"),a=JSON.parse(e.nodes),r=JSON.parse(e.error);var s=0;o.forEach(function(e){window.console.log(e);let t=e.getElementsByTagName("a");for(var l=0;l<t.length;l++)if(null!=a[s][l]){let n=a[s][l].split("-");"T"==n[2]?t[l].getElementsByTagName("circle")[0].style.fill="green":"F"==n[2]?t[l].getElementsByTagName("circle")[0].style.fill="red":(a[s].splice(a[s][l],1),l--)}else t[l].getElementsByTagName("circle")[0].style.fill="grey";s++}),s=0,document.querySelectorAll(".svg-graph > div").forEach(function(e){e.style.alignSelf="center",e.style.justifySelf="center",e.style.textAlign="center",e.innerHTML+=r[s],window.MathJax.typesetPromise([e]).then(()=>{window.MathJax.startup.document.state(0),window.MathJax.texReset(),window.MathJax.typeset()}),s++})}})})})})}).fail(function(e){window.console.log(e)})})})},excel:function(){let e=document.querySelector("#exchange");e.addEventListener("click",function(){require(["core/ajax","core/notification"],function(e,t){let l=e.call([{methodname:"block_stack_excel",args:{default_parameter:1}}])[0];l.done(function(e){window.console.log(e);try{var t=[];for(let l=0;l<e.length;l++){let n=[e[l].name];for(let o=0;o<e[0].quiz.length;o++)null!=e[l].quiz[o]?0==l?n.push(e[l].quiz[o].quiz_name):n.push(parseInt(e[l].quiz[o].mark).toFixed(2)):n.push("No calificado");0!=l?n.push(e[l].punctuation):n.push("Puntuaci\xf3n"),t.push(n)}window.console.log(t);var a=window.XLSX.utils.book_new(),r=window.XLSX.utils.aoa_to_sheet(t);a.SheetNames.push(e[0].name),a.Sheets[e[0].name]=r,window.console.log(a.Sheets[e[0].name]),a.Sheets[e[0].name]["!cols"]=[{wpx:150},{wpx:200}],window.console.log("Length"+t.length*t[0].length),a.Sheets[e[0].name].A1.s={fill:{patternType:"solid",fgColor:{rgb:"111111"}}},window.console.log(a.Sheets[e[0].name]);for(var s=window.XLSX.write(a,{bookType:"xlsx",type:"binary"}),c=new ArrayBuffer(s.length),i=new Uint8Array(c),u=0;u<s.length;u++)i[u]=255&s.charCodeAt(u);var d=new Blob([c],{type:"application/octet-stream"}),g=window.URL.createObjectURL(d),p=document.createElement("a");p.href=g,p.download=e[0].name+".xlsx",p.click(),window.URL.revokeObjectURL(g)}catch(h){window.console.log(h)}}).fail(function(e){window.console.log(e)})})}),window.console.log(e)}}});