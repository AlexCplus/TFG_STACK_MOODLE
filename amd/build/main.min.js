define(["jquery","jqueryui","block_stack/main"],function(){return{init:function(){window.console.log("teacher");var b=document.querySelectorAll("#menu-courses");for(let a=0;a<b.length;a++)b[a].addEventListener("click",function(a){var b=a.target.id.split("-");require(["core/ajax","core/notification"],function(a,d){window.console.log(a);var c={methodname:"block_stack_get_chart_db",args:{id_course:b[1]}};a.call([c])[0].done(function(a){require(["core/chartjs"],function(){let b=document.createElement("canvas");b.setAttribute("id","myChart"),document.querySelector("#render-chart").appendChild(b);let c=b.getContext("2d");new Chart(c,{type:"doughnut",data:{labels:["Superados","No Superados",],datasets:[{label:"% de estudiantes",data:[a.passed,a.not_passed],backgroundColor:["rgb(119, 221, 119)","rgb(255, 0, 0)"],hoverOffset:4}]}})}),document.getElementById("course_not_selected").hidden=!0,window.console.log(a)}).fail(function(a){window.console.log(a)})})})},init_student:function(){window.console.log("student")},search:function(){document.querySelector("input").addEventListener("input",function(a){window.console.log(a.target.value),require(["core/ajax","core/notification"],function(b,c){window.console.log(c);var d={methodname:"block_stack_get_table_students",args:{input_value:a.target.value}};b.call([d])[0].done(function(c){window.console.log(c),null!=document.querySelector("#students-list")&&$("#students-list").remove();let a=document.createElement("ul");a.setAttribute("id","students-list"),a.setAttribute("class","list-group"),c.forEach(c=>{let b=document.createElement("li");b.setAttribute("class","list-group-item"),a.appendChild(b),b.innerHTML=b.innerHTML+c.name}),document.querySelector('[role="main"]').appendChild(a);var d=document.querySelectorAll("#students-list li");for(let b=0;b<d.length;b++)d[b].addEventListener("click",function(a){$("#search-student").val(d[b].innerText),window.console.log(d[b]),d[b].removeAttribute("class"),d[b].setAttribute("class","list-group-item active")})}).fail(function(a){window.console.log(a)})})})},graph:function(){let a=document.querySelector(".custom-select");a.addEventListener("change",function(b){require(["core/ajax","core/notification"],function(b,d){window.console.log("Entrada"+a.selectedOptions[0].value);var c={methodname:"block_stack_get_questions_shown",args:{selected_item:a.selectedOptions[0].value}};b.call([c])[0].done(function(b){document.querySelector("#container-questions .row")&&document.querySelector("#container-questions .row").remove(),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),window.console.log(b),document.querySelectorAll(".custom-select")[1]&&document.querySelectorAll(".custom-select")[1].remove(),document.querySelector(".user")&&document.querySelector(".user").remove();let c=document.createElement("div"),d=document.createElement("select");d.setAttribute("class","custom-select"),d.style.marginTop="40px";let e=document.createElement("option");e.value="-1",e.text="-Selecciona un intento",e.selected,d.appendChild(e),document.querySelector("#container-questions").appendChild(c),document.querySelector("#container-questions").appendChild(d);for(var a=0;a<b.length;a++){let i=!1;for(var f=0;f<document.getElementsByTagName("select")[1].childElementCount;f++)document.getElementsByTagName("select")[1].children[f].value==b[a].attempt&&(i=!0);if(!i){let g=document.createElement("option");g.value=b[a].attempt,g.text="Intento: "+b[a].attempt,d.appendChild(g)}}c.setAttribute("class","user"),c.style.backgroundColor="hwb(180deg 94% 2%)",c.style.margin="inherit",c.style.height="300px";let j=document.createElement("canvas");c.appendChild(j);for(var k=[],l=[],a=0;a<b.length;a++)k[a]="Intento "+b[a].attempt,l[a]=b[a].mark;require(["core/chartjs"],function(){let a=document.getElementsByTagName("canvas")[0].getContext("2d");new Chart(a,{type:"line",data:{labels:k,datasets:[{label:"Evoluci\xf3n de las calificaciones atendiendo a los intentos",data:l,fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}})});let h=document.createElement("div");h.setAttribute("class","row"),h.style.backgroundColor="beige",h.style.margin="inherit",document.querySelectorAll(".custom-select")[1].addEventListener("change",function(a){document.querySelector("#container-questions .row")&&(document.querySelector("#container-questions .row").innerHTML=""),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),b.forEach(b=>{let i=document.querySelectorAll(".custom-select")[1].selectedIndex;if(b.attempt==i){let f=document.createElement("div");f.setAttribute("class","col-lg-4 col-md-6 col-sm-6"),h.appendChild(f);let c=document.createElement("div");c.setAttribute("class","category mb-30"),f.appendChild(c),c.style.paddingTop="50px",c.style.paddingBottom="50px";let a=document.createElement("div");a.setAttribute("class","question"),a.setAttribute("id",b.id),a.style.height="200px",a.style.border="1px solid transparent",a.style.padding="30px 19px 25px 19px",a.style.borderRadius="5px",a.style.boxShadow="rgba(0, 0, 0, 0.35) 0px 5px 15px",a.style.cursor="pointer",a.style.overflow="auto",c.appendChild(a);let e=document.createElement("span");e.setAttribute("class","colors1 mb-4"),e.style.fontWeight="700",a.appendChild(e),e.innerHTML=b.name;let g=document.createElement("span");g.setAttribute("class","colors1 mb-4"),a.appendChild(g),g.innerHTML="<br> Puntuaci\xf3n: "+b.mark+"/"+b.maxgrade;let d=document.createElement("h3");d.innerHTML="Preguntas",d.style.paddingTop="15px",d.style.paddingLeft="1px",d.style.position="absolute",h.appendChild(d)}}),document.querySelector("#container-questions").appendChild(h),window.console.log(h),document.querySelectorAll(".question").forEach(function(a){a.onmouseover=function(){a.style.borderColor="#0d6efd"},a.onmouseout=function(){a.style.borderColor="transparent"},a.addEventListener("click",function(){document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),b.forEach(function(c){if(c.id==a.id){window.console.log(c),window.console.log(a);let b=document.createElement("div");b.setAttribute("class","svg-graph"),b.style.backgroundColor="bisque",b.style.marginTop="50px",b.style.display="grid";let d=JSON.parse(c.graph);window.console.log(d),Array.isArray(d)?d.forEach(function(a){window.console.log(a);let c=document.createElement("div");c.innerHTML+=a,b.appendChild(c)}):b.appendChild(d),document.querySelector("#container-questions").appendChild(b);let e=document.querySelectorAll(".stack_abstract_graph"),g=JSON.parse(c.nodes),h=JSON.parse(c.error);var f=0;e.forEach(function(c){window.console.log(c);let b=c.getElementsByTagName("a");for(var a=0;a<b.length;a++)if(null!=g[f][a]){let d=g[f][a].split("-");"T"==d[2]?b[a].getElementsByTagName("circle")[0].style.fill="green":"F"==d[2]?b[a].getElementsByTagName("circle")[0].style.fill="red":(g[f].splice(g[f][a],1),a--)}else b[a].getElementsByTagName("circle")[0].style.fill="grey";f++}),f=0,document.querySelectorAll(".svg-graph > div").forEach(function(a){a.style.alignSelf="center",a.style.justifySelf="center",a.style.textAlign="center",a.innerHTML+=h[f],f++})}})})})})}).fail(function(a){window.console.log(a)})})})}}})