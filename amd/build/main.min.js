define(["jquery","jqueryui","block_stack/main"],function(){return{init:function(){window.console.log("teacher");var e=document.querySelectorAll("#menu-courses");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.target.id.split("-");require(["core/ajax","core/notification"],function(e,o){window.console.log(e);var l={methodname:"block_stack_get_chart_db",args:{id_course:t[1]}};e.call([l])[0].done(function(e){require(["core/chartjs"],function(){let t=document.createElement("canvas");t.setAttribute("id","myChart"),document.querySelector("#render-chart").appendChild(t);let o=t.getContext("2d");new Chart(o,{type:"doughnut",data:{labels:["Superados","No Superados",],datasets:[{label:"% de estudiantes",title:"Total de cuestionarios con m\xe1s de un intento",data:[e.passed,e.not_passed],backgroundColor:["rgb(119, 221, 119)","rgb(255, 0, 0)"],hoverOffset:4}]}})}),document.getElementById("course_not_selected").hidden=!0,window.console.log(e)}).fail(function(e){window.console.log(e)})})})},init_student:function(){window.console.log("student");var e=document.querySelectorAll("#menu-courses");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.target.id.split("-");require(["core/ajax","core/notification"],function(e,o){window.console.log(e);var l={methodname:"block_stack_get_chart_db_student",args:{id_course:t[1]}};e.call([l])[0].done(function(e){require(["core/chartjs"],function(){let t=document.createElement("canvas");t.setAttribute("id","myChart"),document.querySelector("#render-chart").appendChild(t);let o=t.getContext("2d");new Chart(o,{type:"doughnut",data:{labels:["Superados","No Superados",],datasets:[{label:"% de estudiantes",title:"Total de cuestionarios con m\xe1s de un intento",data:[e.passed,e.not_passed],backgroundColor:["rgb(119, 221, 119)","rgb(255, 0, 0)"],hoverOffset:4}]}})}),document.getElementById("course_not_selected").hidden=!0,window.console.log(e)}).fail(function(e){window.console.log(e)})})})},search:function(){document.querySelector("input").addEventListener("input",function(e){window.console.log(e.target.value),require(["core/ajax","core/notification"],function(t,o){window.console.log(o);var l={methodname:"block_stack_get_table_students",args:{input_value:e.target.value}};t.call([l])[0].done(function(e){window.console.log(e),null!=document.querySelector("#students-list")&&$("#students-list").remove();let t=document.createElement("ul");t.setAttribute("id","students-list"),t.setAttribute("class","list-group"),e.forEach(e=>{let o=document.createElement("li");o.setAttribute("class","list-group-item"),t.appendChild(o),o.innerHTML=o.innerHTML+e.name}),document.querySelector('[role="main"]').appendChild(t);var o=document.querySelectorAll("#students-list li");for(let l=0;l<o.length;l++)o[l].addEventListener("click",function(e){$("#search-student").val(o[l].innerText),window.console.log(o[l]),o[l].removeAttribute("class"),o[l].setAttribute("class","list-group-item active")})}).fail(function(e){window.console.log(e)})})})},graph:function(){var e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.id="MathJax-script",e.async=!0,document.getElementsByTagName("head")[0].appendChild(e),window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}};let t=document.querySelector(".custom-select");t.addEventListener("change",function(e){require(["core/ajax","core/notification"],function(e,o){window.console.log("Entrada"+t.selectedOptions[0].value);var l={methodname:"block_stack_get_questions_shown",args:{selected_item:t.selectedOptions[0].value}};e.call([l])[0].done(function(e){document.querySelector("#container-questions .row")&&document.querySelector("#container-questions .row").remove(),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),window.console.log(e),document.querySelectorAll(".custom-select")[1]&&document.querySelectorAll(".custom-select")[1].remove(),document.querySelector(".user")&&document.querySelector(".user").remove();let t=document.createElement("div"),o=document.createElement("select");o.setAttribute("class","custom-select"),o.style.marginTop="40px";let l=document.createElement("option");l.value="-1",l.text="-Selecciona un intento",l.selected,o.appendChild(l),document.querySelector("#container-questions").appendChild(t),document.querySelector("#container-questions").appendChild(o);for(var n=0;n<e.length;n++){let r=!1;for(var a=0;a<document.getElementsByTagName("select")[1].childElementCount;a++)document.getElementsByTagName("select")[1].children[a].value==e[n].attempt&&(r=!0);if(!r){let s=document.createElement("option");s.value=e[n].attempt,s.text="Intento: "+e[n].attempt,o.appendChild(s)}}t.setAttribute("class","user"),t.style.backgroundColor="hwb(180deg 94% 2%)",t.style.margin="inherit",t.style.height="300px";let c=document.createElement("canvas");t.appendChild(c);for(var i=[],d=[],n=0;n<e.length;n++)i[n]="Intento "+e[n].attempt,d[n]=e[n].mark;require(["core/chartjs"],function(){let e=document.getElementsByTagName("canvas")[0].getContext("2d");new Chart(e,{type:"line",data:{labels:i,datasets:[{label:"Evoluci\xf3n de las calificaciones atendiendo a los intentos",data:d,fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}})});let u=document.createElement("div");u.setAttribute("class","row"),u.style.backgroundColor="beige",u.style.margin="inherit",document.querySelectorAll(".custom-select")[1].addEventListener("change",function(t){document.querySelector("#container-questions .row")&&(document.querySelector("#container-questions .row").innerHTML=""),document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),e.forEach(e=>{let t=document.querySelectorAll(".custom-select")[1].selectedIndex;if(e.attempt==t){let o=document.createElement("div");o.setAttribute("class","col-lg-4 col-md-6 col-sm-6"),u.appendChild(o);let l=document.createElement("div");l.setAttribute("class","category mb-30"),o.appendChild(l),l.style.paddingTop="50px",l.style.paddingBottom="50px";let n=document.createElement("div");n.setAttribute("class","question"),n.setAttribute("id",e.id),n.style.height="200px",n.style.border="1px solid transparent",n.style.padding="30px 19px 25px 19px",n.style.borderRadius="5px",n.style.boxShadow="rgba(0, 0, 0, 0.35) 0px 5px 15px",n.style.cursor="pointer",n.style.overflow="auto",l.appendChild(n);let r=document.createElement("span");r.setAttribute("class","colors1 mb-4"),r.style.fontWeight="700",n.appendChild(r),r.innerHTML=e.name;let a=document.createElement("span");a.setAttribute("class","colors1 mb-4"),n.appendChild(a),a.innerHTML="<br> Puntuaci\xf3n: "+e.mark+"/"+e.maxgrade;let s=document.createElement("h3");s.innerHTML="Preguntas",s.style.paddingTop="15px",s.style.paddingLeft="1px",s.style.position="absolute",u.appendChild(s)}}),document.querySelector("#container-questions").appendChild(u),window.console.log(u),document.querySelectorAll(".question").forEach(function(t){t.onmouseover=function(){t.style.borderColor="#0d6efd"},t.onmouseout=function(){t.style.borderColor="transparent"},t.addEventListener("click",function(){document.querySelector(".svg-graph")&&document.querySelector(".svg-graph").remove(),e.forEach(function(e){if(e.id==t.id){window.console.log(e),window.console.log(t);let o=document.createElement("div");o.setAttribute("class","svg-graph"),o.style.backgroundColor="bisque",o.style.marginTop="50px",o.style.display="grid";let l=JSON.parse(e.graph);window.console.log(l),Array.isArray(l)?l.forEach(function(e){window.console.log(e);let t=document.createElement("div");t.innerHTML+=e,o.appendChild(t)}):o.appendChild(l),document.querySelector("#container-questions").appendChild(o);let n=document.querySelectorAll(".stack_abstract_graph"),r=JSON.parse(e.nodes),a=JSON.parse(e.error);var s=0;n.forEach(function(e){window.console.log(e);let t=e.getElementsByTagName("a");for(var o=0;o<t.length;o++)if(null!=r[s][o]){let l=r[s][o].split("-");"T"==l[2]?t[o].getElementsByTagName("circle")[0].style.fill="green":"F"==l[2]?t[o].getElementsByTagName("circle")[0].style.fill="red":(r[s].splice(r[s][o],1),o--)}else t[o].getElementsByTagName("circle")[0].style.fill="grey";s++}),s=0,document.querySelectorAll(".svg-graph > div").forEach(function(e){e.style.alignSelf="center",e.style.justifySelf="center",e.style.textAlign="center",e.innerHTML+=a[s],window.MathJax.typesetPromise([e]).then(()=>{window.MathJax.startup.document.state(0),window.MathJax.texReset(),window.MathJax.typeset()}),s++})}})})})})}).fail(function(e){window.console.log(e)})})})},excel:function(){let e=document.querySelector("#exchange");e.addEventListener("click",function(){require(["core/ajax","core/notification"],function(e,t){let o=e.call([{methodname:"block_stack_excel",args:{default_parameter:1}}])[0];o.done(function(e){try{var t=window.XLSX.utils.book_new(),o=window.XLSX.utils.aoa_to_sheet([["Joa Doe","joa@doe.com"],["Job Doe","job@doe.com"],["Joe Doe","joe@doe.com"],["Jon Doe","jon@doe.com"],["Joy Doe","joy@doe.com"]]);t.SheetNames.push("First"),t.Sheets.First=o;for(var l=window.XLSX.write(t,{bookType:"xlsx",type:"binary"}),n=new ArrayBuffer(l.length),r=new Uint8Array(n),a=0;a<l.length;a++)r[a]=255&l.charCodeAt(a);var s=new Blob([n],{type:"application/octet-stream"}),c=window.URL.createObjectURL(s),i=document.createElement("a");i.href=c,i.download="demo.xlsx",i.click(),window.URL.revokeObjectURL(c)}catch(d){window.console.log(d)}}).fail(function(e){window.console.log(e)})})}),window.console.log(e)}}});